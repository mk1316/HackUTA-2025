{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///Users/piyushsingh/HackUTA-2025/re-factor/src/app/api/process-pdf/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { GoogleGenAI } from '@google/genai';\n\n/**\n * API route for processing PDF files with Gemini AI\n * Handles file upload, validation, and AI-powered summarization\n * \n * @param request - Next.js request object containing the uploaded file\n * @returns JSON response with AI-generated summary or error message\n */\nexport async function POST(request: NextRequest): Promise<NextResponse> {\n  try {\n    // Extract file from form data\n    const formData = await request.formData();\n    const file = formData.get('file') as File;\n\n    // Validate file presence\n    if (!file) {\n      return NextResponse.json(\n        { error: 'No file provided' }, \n        { status: 400 }\n      );\n    }\n\n    // Validate file type - only PDF files are allowed\n    if (file.type !== 'application/pdf') {\n      return NextResponse.json(\n        { error: 'File must be a PDF' }, \n        { status: 400 }\n      );\n    }\n\n    // Validate file size (optional - limit to 10MB)\n    const maxSizeInBytes = 10 * 1024 * 1024; // 10MB\n    if (file.size > maxSizeInBytes) {\n      return NextResponse.json(\n        { error: 'File size must be less than 10MB' }, \n        { status: 400 }\n      );\n    }\n\n    // Convert file to base64 for Gemini API\n    const arrayBuffer = await file.arrayBuffer();\n    const base64 = Buffer.from(arrayBuffer).toString('base64');\n\n    // Validate API key presence\n    const apiKey = process.env.GEMINI_API_KEY;\n    if (!apiKey) {\n      console.error('GEMINI_API_KEY environment variable is not set');\n      return NextResponse.json(\n        { error: 'API configuration error' }, \n        { status: 500 }\n      );\n    }\n\n    // Initialize Gemini AI client\n    const genAI = new GoogleGenAI({ apiKey });\n\n    // Prepare content for Gemini AI processing with syllabus extraction prompt\n    const prompt = `\n    Extract ALL assignments, exams, projects, and important dates from this syllabus PDF.\n    \n    FOCUS ON THE \"ASSIGNMENTS\" COLUMN - look for phrases like \"Due by\", \"Assigned\", and specific due dates.\n    \n    CRITICAL INSTRUCTIONS:\n    1. Find EVERY assignment, homework, quiz with due dates (look for: \"Team:\", \"Individual:\", \"HW:\", \"Assignment\", \"Assigned\", \"Due by\",)\n    2. Find ALL exams (Midterm, Finals, Reviews, etc.) and their dates\n    3. Find ALL projects, presentations, reports, and their due dates\n    4. Extract team member evaluations, sprint plans, sprint reviews, and any other graded work\n    5. Include the full title/description for each item\n    6. Convert all dates to YYYY-MM-DD format (assume year 2025 if not specified)\n    7. If a date range is given (e.g., \"8/18-8/22\"), use the END date as the due date\n    8. Pay special attention to items with time stamps like \"11:59PM\" - these are important deadlines\n    \n    Return ONLY valid JSON in this exact format (no markdown, no extra text):\n    {\n        \"course_name\": \"Full Course Name\",\n        \"course_code\": \"Course Code\",\n        \"professor\": {\n            \"name\": \"Professor Name\",\n            \"email\": \"email@domain.com\",\n            \"office_hours\": \"Office hours description\"\n        },\n        \"class_schedule\": \"Class meeting schedule\",\n        \"homework\": [\n            {\n                \"title\": \"Assignment Title\",\n                \"due_date\": \"YYYY-MM-DD\",\n                \"description\": \"Assignment description\"\n            }\n        ],\n        \"exams\": [\n            {\n                \"type\": \"Midterm/Final/Quiz\",\n                \"date\": \"YYYY-MM-DD\",\n                \"description\": \"Exam details\"\n            }\n        ],\n        \"projects\": [\n            {\n                \"title\": \"Project Title\",\n                \"due_date\": \"YYYY-MM-DD\",\n                \"description\": \"Project description\"\n            }\n        ]\n    }\n    `;\n\n    const contents = [\n      { \n        text: prompt\n      },\n      {\n        inlineData: {\n          mimeType: 'application/pdf',\n          data: base64\n        }\n      }\n    ];\n\n    // Generate AI-powered syllabus extraction using Gemini\n    const result = await genAI.models.generateContent({\n      model: \"gemini-2.0-flash-exp\",\n      contents: contents\n    });\n    const rawResponse = result.text;\n\n    // Parse the JSON response from Gemini\n    let parsedData;\n    try {\n      // Validate response exists\n      if (!rawResponse) {\n        throw new Error('No response received from AI');\n      }\n      \n      // Clean the response to extract only JSON (remove any markdown formatting)\n      const jsonMatch = rawResponse.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        throw new Error('No valid JSON found in response');\n      }\n      \n      const jsonString = jsonMatch[0];\n      parsedData = JSON.parse(jsonString);\n    } catch (parseError) {\n      console.error('Error parsing JSON response:', parseError);\n      return NextResponse.json(\n        { \n          error: 'Failed to parse AI response. Please try again.',\n          success: false \n        },\n        { status: 500 }\n      );\n    }\n\n    // Return successful response with structured syllabus data\n    return NextResponse.json({ \n      result: parsedData,\n      success: true \n    });\n\n  } catch (error) {\n    // Log error for debugging\n    console.error('Error processing PDF with Gemini AI:', error);\n    \n    // Return user-friendly error message\n    return NextResponse.json(\n      { \n        error: 'Failed to process PDF. Please try again.',\n        success: false \n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AASO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,8BAA8B;QAC9B,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,yBAAyB;QACzB,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmB,GAC5B;gBAAE,QAAQ;YAAI;QAElB;QAEA,kDAAkD;QAClD,IAAI,KAAK,IAAI,KAAK,mBAAmB;YACnC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,gDAAgD;QAChD,MAAM,iBAAiB,KAAK,OAAO,MAAM,OAAO;QAChD,IAAI,KAAK,IAAI,GAAG,gBAAgB;YAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmC,GAC5C;gBAAE,QAAQ;YAAI;QAElB;QAEA,wCAAwC;QACxC,MAAM,cAAc,MAAM,KAAK,WAAW;QAC1C,MAAM,SAAS,OAAO,IAAI,CAAC,aAAa,QAAQ,CAAC;QAEjD,4BAA4B;QAC5B,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,IAAI,CAAC,QAAQ;YACX,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,8BAA8B;QAC9B,MAAM,QAAQ,IAAI,4KAAW,CAAC;YAAE;QAAO;QAEvC,2EAA2E;QAC3E,MAAM,SAAS,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA+ChB,CAAC;QAED,MAAM,WAAW;YACf;gBACE,MAAM;YACR;YACA;gBACE,YAAY;oBACV,UAAU;oBACV,MAAM;gBACR;YACF;SACD;QAED,uDAAuD;QACvD,MAAM,SAAS,MAAM,MAAM,MAAM,CAAC,eAAe,CAAC;YAChD,OAAO;YACP,UAAU;QACZ;QACA,MAAM,cAAc,OAAO,IAAI;QAE/B,sCAAsC;QACtC,IAAI;QACJ,IAAI;YACF,2BAA2B;YAC3B,IAAI,CAAC,aAAa;gBAChB,MAAM,IAAI,MAAM;YAClB;YAEA,2EAA2E;YAC3E,MAAM,YAAY,YAAY,KAAK,CAAC;YACpC,IAAI,CAAC,WAAW;gBACd,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,aAAa,SAAS,CAAC,EAAE;YAC/B,aAAa,KAAK,KAAK,CAAC;QAC1B,EAAE,OAAO,YAAY;YACnB,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,2DAA2D;QAC3D,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,QAAQ;YACR,SAAS;QACX;IAEF,EAAE,OAAO,OAAO;QACd,0BAA0B;QAC1B,QAAQ,KAAK,CAAC,wCAAwC;QAEtD,qCAAqC;QACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS;QACX,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}